<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>NSE subsetting — nse • prt</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="NSE subsetting — nse" />
<meta property="og:description" content="A cornerstone feature of prt is the ability to load a (small) subset of
rows (or columns) from a much larger tabular dataset. In order to specify
such a subset, an implementation of the base R S3 generic function
subset() is provided, driving the non-standard evaluation (NSE) of an
expression within the context of the data (with similar semantics as the
base R implementation for data.frames)." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">prt</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/prt.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/nbenn/prt/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>NSE subsetting</h1>
    <small class="dont-index">Source: <a href='https://github.com/nbenn/prt/blob/master/R/nse.R'><code>R/nse.R</code></a></small>
    <div class="hidden name"><code>nse.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>A cornerstone feature of <code>prt</code> is the ability to load a (small) subset of
rows (or columns) from a much larger tabular dataset. In order to specify
such a subset, an implementation of the base R S3 generic function
<code><a href='https://rdrr.io/r/base/subset.html'>subset()</a></code> is provided, driving the non-standard evaluation (NSE) of an
expression within the context of the data (with similar semantics as the
base R implementation for <code>data.frame</code>s).</p>
    </div>

    <pre class="usage"><span class='co'># S3 method for prt</span>
<span class='fu'><a href='https://rdrr.io/r/base/subset.html'>subset</a></span>(<span class='kw'>x</span>, <span class='kw'>subset</span>, <span class='kw'>select</span>, part_safe = <span class='fl'>FALSE</span>, drop = <span class='fl'>FALSE</span>, <span class='kw'>...</span>)

<span class='fu'>subset_quo</span>(
  <span class='kw'>x</span>,
  subset = <span class='kw'>NULL</span>,
  select = <span class='kw'>NULL</span>,
  part_safe = <span class='fl'>FALSE</span>,
  env = <span class='fu'><a href='https://rdrr.io/r/base/sys.parent.html'>parent.frame</a></span>()
)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>x</th>
      <td><p>object to be subsetted.</p></td>
    </tr>
    <tr>
      <th>subset</th>
      <td><p>logical expression indicating elements or rows to keep:
    missing values are taken as false.</p></td>
    </tr>
    <tr>
      <th>select</th>
      <td><p>expression, indicating columns to select from a
    data frame.</p></td>
    </tr>
    <tr>
      <th>part_safe</th>
      <td><p>Logical flag indicating whether the <code>subset</code> expression
can be safely be applied to individual partitions.</p></td>
    </tr>
    <tr>
      <th>drop</th>
      <td><p>passed on to <code><a href='https://rdrr.io/r/base/Extract.html'>[</a></code> indexing operator.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>further arguments to be passed to or from other methods.</p></td>
    </tr>
    <tr>
      <th>env</th>
      <td><p>The environment in which <code>subset</code> and <code>select</code> are evaluated in.
This environment is not applicable for quosures because they have their own
environments.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>The functions powering NSE are <code><a href='https://rlang.r-lib.org/reference/nse-defuse.html'>rlang::enquo()</a></code> which quote the <code>subset</code> and
<code>select</code> arguments and <code><a href='https://rlang.r-lib.org/reference/eval_tidy.html'>rlang::eval_tidy()</a></code> which evaluates the
expressions. This allows for some
<a href='https://rlang.r-lib.org'><code>rlang</code></a>-specific features to be used, such as the
<code>.data</code>/<code>.env</code> pronouns, or the double-curly brace forwarding operator. For
some example code, please refer to
<a href='../doc/prt.html'><code><a href='../articles/prt.html'>vignette("prt", package = "prt")</a></code></a>.</p>
<p>While the function <code><a href='https://rdrr.io/r/base/subset.html'>subset()</a></code> quotes the arguments passed as <code>subset</code> and
<code>select</code>, the function <code>subset_quo()</code> can be used to operate on already
quoted expressions. A final noteworthy departure from the base R interface
is the <code>part_safe</code> argument: this logical flag indicates whether it is safe
to evaluate the expression on partitions individually or whether
dependencies between partitions prevent this from yielding correct results.
As it is not straightforward to determine if dependencies might exists from
the expression alone, the default is <code>FALSE</code>, which in many cases will
result in a less efficient resolution of the row-selection and it is up to
the user to enable this optimization.</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='kw'>dat</span> <span class='op'>&lt;-</span> <span class='fu'><a href='new_prt.html'>as_prt</a></span>(<span class='kw'>mtcars</span>, n_chunks = <span class='fl'>2L</span>)

<span class='fu'><a href='https://rdrr.io/r/base/subset.html'>subset</a></span>(<span class='kw'>dat</span>, <span class='kw'>cyl</span> <span class='op'>==</span> <span class='fl'>6</span>)
</div><div class='output co'>#&gt;     mpg cyl  disp  hp drat    wt  qsec vs am gear carb
#&gt; 1: 21.0   6 160.0 110 3.90 2.620 16.46  0  1    4    4
#&gt; 2: 21.0   6 160.0 110 3.90 2.875 17.02  0  1    4    4
#&gt; 3: 21.4   6 258.0 110 3.08 3.215 19.44  1  0    3    1
#&gt; 4: 18.1   6 225.0 105 2.76 3.460 20.22  1  0    3    1
#&gt; 5: 19.2   6 167.6 123 3.92 3.440 18.30  1  0    4    4
#&gt; 6: 17.8   6 167.6 123 3.92 3.440 18.90  1  0    4    4
#&gt; 7: 19.7   6 145.0 175 3.62 2.770 15.50  0  1    5    6</div><div class='input'><span class='fu'><a href='https://rdrr.io/r/base/subset.html'>subset</a></span>(<span class='kw'>dat</span>, <span class='kw'>cyl</span> <span class='op'>==</span> <span class='fl'>6</span> <span class='op'>&amp;</span> <span class='kw'>hp</span> <span class='op'>&gt;</span> <span class='fl'>110</span>)
</div><div class='output co'>#&gt;     mpg cyl  disp  hp drat   wt qsec vs am gear carb
#&gt; 1: 19.2   6 167.6 123 3.92 3.44 18.3  1  0    4    4
#&gt; 2: 17.8   6 167.6 123 3.92 3.44 18.9  1  0    4    4
#&gt; 3: 19.7   6 145.0 175 3.62 2.77 15.5  0  1    5    6</div><div class='input'>
<span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>colnames</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/subset.html'>subset</a></span>(<span class='kw'>dat</span>, select = <span class='kw'>mpg</span><span class='op'>:</span><span class='kw'>hp</span>))
</div><div class='output co'>#&gt; [1] "mpg"  "cyl"  "disp" "hp"  </div><div class='input'><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>colnames</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/subset.html'>subset</a></span>(<span class='kw'>dat</span>, select = <span class='op'>-</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='kw'>vs</span>, <span class='kw'>am</span>)))
</div><div class='output co'>#&gt; [1] "mpg"  "cyl"  "disp" "hp"   "drat" "wt"   "qsec" "gear" "carb"</div><div class='input'>
<span class='kw'>sub_6</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/subset.html'>subset</a></span>(<span class='kw'>dat</span>, <span class='kw'>cyl</span> <span class='op'>==</span> <span class='fl'>6</span>)

<span class='kw'>thresh</span> <span class='op'>&lt;-</span> <span class='fl'>6</span>
<span class='fu'><a href='https://rdrr.io/r/base/identical.html'>identical</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/subset.html'>subset</a></span>(<span class='kw'>dat</span>, <span class='kw'>cyl</span> <span class='op'>==</span> <span class='kw'>thresh</span>), <span class='kw'>sub_6</span>)
</div><div class='output co'>#&gt; [1] TRUE</div><div class='input'><span class='fu'><a href='https://rdrr.io/r/base/identical.html'>identical</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/subset.html'>subset</a></span>(<span class='kw'>dat</span>, <span class='kw'>cyl</span> <span class='op'>==</span> <span class='kw'>.env</span><span class='op'>$</span><span class='kw'>thresh</span>), <span class='kw'>sub_6</span>)
</div><div class='output co'>#&gt; [1] TRUE</div><div class='input'>
<span class='kw'>cyl</span> <span class='op'>&lt;-</span> <span class='fl'>6</span>
<span class='fu'><a href='https://rdrr.io/r/base/identical.html'>identical</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/subset.html'>subset</a></span>(<span class='kw'>dat</span>, <span class='kw'>cyl</span> <span class='op'>==</span> <span class='kw'>cyl</span>), <span class='kw'>data.table</span>::<span class='fu'><a href='https://Rdatatable.gitlab.io/data.table/reference/as.data.table.html'>as.data.table</a></span>(<span class='kw'>dat</span>))
</div><div class='output co'>#&gt; [1] TRUE</div><div class='input'><span class='fu'><a href='https://rdrr.io/r/base/identical.html'>identical</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/subset.html'>subset</a></span>(<span class='kw'>dat</span>, <span class='kw'>cyl</span> <span class='op'>==</span> <span class='op'>!</span><span class='op'>!</span><span class='kw'>cyl</span>), <span class='kw'>sub_6</span>)
</div><div class='output co'>#&gt; [1] TRUE</div><div class='input'><span class='fu'><a href='https://rdrr.io/r/base/identical.html'>identical</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/subset.html'>subset</a></span>(<span class='kw'>dat</span>, <span class='kw'>.data</span><span class='op'>$</span><span class='kw'>cyl</span> <span class='op'>==</span> <span class='kw'>.env</span><span class='op'>$</span><span class='kw'>cyl</span>), <span class='kw'>sub_6</span>)
</div><div class='output co'>#&gt; [1] TRUE</div><div class='input'>
<span class='kw'>expr</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/substitute.html'>quote</a></span>(<span class='kw'>cyl</span> <span class='op'>==</span> <span class='fl'>6</span>)
<span class='co'># passing a quoted expression to subset() will yield an error</span>
<span class='co'>if</span> (<span class='fl'>FALSE</span>) {
  <span class='fu'><a href='https://rdrr.io/r/base/subset.html'>subset</a></span>(<span class='kw'>dat</span>, <span class='kw'>expr</span>)
}
<span class='fu'><a href='https://rdrr.io/r/base/identical.html'>identical</a></span>(<span class='fu'>subset_quo</span>(<span class='kw'>dat</span>, <span class='kw'>expr</span>), <span class='kw'>sub_6</span>)
</div><div class='output co'>#&gt; <span class='message'>Evaluating row subsetting over the entire `prt` at once. If applicable consider the `part_safe` argument.</span>
#&gt; <span class='message'></span>
#&gt; <span class='message'><span style='color: #555555;'>This message is displayed once every 8 hours.</span><span></span></div><div class='output co'>#&gt; [1] TRUE</div><div class='input'>
<span class='fu'><a href='https://rdrr.io/r/base/identical.html'>identical</a></span>(
  <span class='fu'><a href='https://rdrr.io/r/base/subset.html'>subset</a></span>(<span class='kw'>dat</span>, <span class='kw'>qsec</span> <span class='op'>&gt;</span> <span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span>(<span class='kw'>qsec</span>), part_safe = <span class='fl'>TRUE</span>),
  <span class='fu'><a href='https://rdrr.io/r/base/subset.html'>subset</a></span>(<span class='kw'>dat</span>, <span class='kw'>qsec</span> <span class='op'>&gt;</span> <span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span>(<span class='kw'>qsec</span>), part_safe = <span class='fl'>FALSE</span>)
)
</div><div class='output co'>#&gt; [1] FALSE</div><div class='input'>
</div></span></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Nicolas Bennett.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.0.9000.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


